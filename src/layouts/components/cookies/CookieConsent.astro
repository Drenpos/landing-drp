---
import "vanilla-cookieconsent/dist/cookieconsent.css";
import "@/styles/ccElegantBlack.css";
---

<!-- <li style="list-style: none;">
  <a
    href="#"
    data-cc="show-preferencesModal"
    class="inline-flex rounded-lg text-xs text-neutral-700 outline-none ring-zinc-500 transition hover:text-neutral-900 focus-visible:ring dark:text-neutral-400 dark:ring-zinc-200 dark:hover:text-neutral-200 dark:focus:outline-none"
  >
    Preferencias cookies
  </a>
</li> -->
<script>
  import * as CookieConsent from "vanilla-cookieconsent";
  import { config } from "./CookieConsentConfig";

  function initCookieConsent() {
    // toggle custom black theme
    document.body.classList.add("cc--elegant-black");

    // Solo inicializar CookieConsent una vez
    if (!window.__cookieConsentInitialized) {
      console.log("Initializing CookieConsent for the first time");
      CookieConsent.run(config);
      window.__cookieConsentInitialized = true;
    } else {
      console.log("CookieConsent already initialized");
    }
    
    // Siempre re-adjuntar event listeners en cada navegación
    attachCookieListeners();
  }

  function attachCookieListeners() {
    // Buscar todos los elementos con data-cc y adjuntar listeners manualmente
    const ccElements = document.querySelectorAll("[data-cc]");
    console.log("Found", ccElements.length, "elements with data-cc");
    
    ccElements.forEach((element) => {
      // Evitar duplicar listeners
      if (element.dataset.ccListenerAttached === 'true') {
        console.log("Listener already attached to element");
        return;
      }
      
      element.dataset.ccListenerAttached = 'true';
      element.addEventListener("click", (e) => {
        const action = element.getAttribute("data-cc");
        console.log("Click detected, action:", action);
        if (action === "show-preferencesModal") {
          e.preventDefault();
          CookieConsent.showPreferences();
        }
      });
    });
  }

  // Ejecutar en la carga inicial
  initCookieConsent();

  // Ejecutar cada vez que Astro carga una nueva página (view transitions)
  document.addEventListener("astro:page-load", () => {
    console.log("astro:page-load - re-initializing cookie consent");
    initCookieConsent();
  });
</script>
