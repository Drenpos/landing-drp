---
import "vanilla-cookieconsent/dist/cookieconsent.css";
import "@/styles/ccElegantBlack.css";
---

<!-- <li style="list-style: none;">
  <a
    href="#"
    data-cc="show-preferencesModal"
    class="inline-flex rounded-lg text-xs text-neutral-700 outline-none ring-zinc-500 transition hover:text-neutral-900 focus-visible:ring dark:text-neutral-400 dark:ring-zinc-200 dark:hover:text-neutral-200 dark:focus:outline-none"
  >
    Preferencias cookies
  </a>
</li> -->
<script>
  import * as CookieConsent from "vanilla-cookieconsent";
  import { config } from "./CookieConsentConfig";

  let initialized = false;

  function initCookieConsent() {
    // toggle custom black theme
    document.body.classList.add("cc--elegant-black");

    // Solo inicializar una vez
    if (!initialized) {
      console.log("Initializing cookie consent for the first time");
      CookieConsent.run(config);
      initialized = true;
    } else {
      console.log("Cookie consent already initialized, attaching listeners");
      // Re-adjuntar event listeners para elementos con data-cc
      attachCookieListeners();
    }
  }

  function attachCookieListeners() {
    // Buscar todos los elementos con data-cc y adjuntar listeners manualmente
    const ccElements = document.querySelectorAll("[data-cc]");
    ccElements.forEach((element) => {
      element.addEventListener("click", (e) => {
        const action = element.getAttribute("data-cc");
        if (action === "show-preferencesModal") {
          e.preventDefault();
          CookieConsent.showPreferences();
        }
      });
    });
  }

  // Ejecutar en la carga inicial
  initCookieConsent();

  // Ejecutar cada vez que Astro carga una nueva pÃ¡gina (view transitions)
  document.addEventListener("astro:page-load", () => {
    console.log("astro:page-load - re-attaching cookie consent listeners");
    initCookieConsent();
  });
</script>
