---
const {
  lott_id,
  w_mobile = "280px",
  h_mobile = "220px",
  w_tablet = "350px",
  h_tablet = "280px",
  w_desktop = "396px",
  h_desktop = "424px",
} = Astro.props;
---

<div class="lottie-container" id={`container-${lott_id}`}>
  <canvas id={lott_id}></canvas>
</div>

<script
  type="module"
  define:vars={{
    lott_id,
    w_mobile,
    h_mobile,
    w_tablet,
    h_tablet,
    w_desktop,
    h_desktop,
  }}
>
  import { DotLottie } from "https://cdn.jsdelivr.net/npm/@lottiefiles/dotlottie-web/+esm";

  function initializeLottie() {
    const container = document.getElementById(`container-${lott_id}`);
    const canvas = document.getElementById(lott_id);

    // Si no existen los elementos, salir
    if (!container || !canvas) return;

    // Evitar inicializar dos veces
    if (canvas.dataset.initialized === "true") return;
    canvas.dataset.initialized = "true";

    // Función para aplicar tamaños según viewport
    const applySize = () => {
      const width = window.innerWidth;
      let w, h;

      if (width < 640) {
        // Móvil
        w = w_mobile;
        h = h_mobile;
      } else if (width < 1024) {
        // Tablet
        w = w_tablet;
        h = h_tablet;
      } else {
        // Desktop
        w = w_desktop;
        h = h_desktop;
      }

      container.style.width = w;
      container.style.height = h;
      canvas.style.width = "100%";
      canvas.style.height = "100%";
    };

    // Aplicar tamaño inicial
    applySize();

    // Reajustar en resize
    let resizeTimeout;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(applySize, 100);
    });

    // Inicializar Lottie
    new DotLottie({
      autoplay: true,
      loop: true,
      canvas: canvas,
      src: `https://lottie.host/${lott_id}.lottie`,
    });
  }

  // Ejecutar en carga inicial
  initializeLottie();

  // Ejecutar después de navegaciones del lado del cliente
  document.addEventListener("astro:page-load", initializeLottie);
</script>

<style>
  .lottie-container {
    margin: 0 auto;
    display: block;
  }

  @media (min-width: 1024px) {
    .lottie-container {
      margin: 0;
    }
  }
</style>
